<\!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ç¢ºèª</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .annotation-item { 
            border: 1px solid #ddd; 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 5px; 
            background: #f9f9f9;
        }
        .filename { font-weight: bold; color: #2c3e50; }
        .disease-count { color: #e74c3c; font-size: 14px; }
        .timestamp { color: #7f8c8d; font-size: 12px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .export-btn { background: #27ae60; color: white; }
        .clear-btn { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ” ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ç¢ºèªãƒ„ãƒ¼ãƒ«</h1>
    
    <div>
        <button class="export-btn" onclick="showAllData()">å…¨ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</button>
        <button class="export-btn" onclick="exportToFile()">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›</button>
        <button class="clear-btn" onclick="clearSpecificData()">ç‰¹å®šãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
    </div>
    
    <div id="results"></div>

    <script>
        function showAllData() {
            const results = document.getElementById('results');
            const savedKeys = Object.keys(localStorage).filter(key => key.startsWith('annotation_'));
            
            if (savedKeys.length === 0) {
                results.innerHTML = '<p>ä¿å­˜æ¸ˆã¿ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            let html = `<h2>ä¿å­˜æ¸ˆã¿ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³: ${savedKeys.length}ä»¶</h2>`;
            
            savedKeys.forEach(key => {
                const fileName = key.replace('annotation_', '');
                const data = JSON.parse(localStorage.getItem(key));
                const annotationCount = data.annotations ? data.annotations.length : 0;
                
                html += `
                    <div class="annotation-item">
                        <div class="filename">ğŸ“ ${fileName}</div>
                        <div class="disease-count">ç—…å¤‰æ•°: ${annotationCount}å€‹</div>
                        <div class="timestamp">ä¿å­˜æ—¥æ™‚: ${data.timestamp || 'ä¸æ˜'}</div>
                        <button onclick="showDetail('${key}')">è©³ç´°è¡¨ç¤º</button>
                        <button onclick="deleteData('${key}')" style="background: #e74c3c; color: white;">å‰Šé™¤</button>
                    </div>
                `;
            });
            
            results.innerHTML = html;
        }
        
        function showDetail(key) {
            const data = JSON.parse(localStorage.getItem(key));
            let detail = `ãƒ•ã‚¡ã‚¤ãƒ«: ${data.fileName}\n`;
            detail += `ç—…å¤‰æ•°: ${data.annotations.length}\n\n`;
            
            data.annotations.forEach((ann, index) => {
                detail += `${index + 1}. ${ann.disease} (${ann.path.length}ç‚¹)\n`;
            });
            
            alert(detail);
        }
        
        function deleteData(key) {
            if (confirm(`${key.replace('annotation_', '')} ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                localStorage.removeItem(key);
                showAllData();
                alert('å‰Šé™¤å®Œäº†');
            }
        }
        
        function exportToFile() {
            const savedKeys = Object.keys(localStorage).filter(key => key.startsWith('annotation_'));
            if (savedKeys.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let exportData = `ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\nä½œæˆæ—¥æ™‚: ${new Date().toLocaleString()}\n\n`;
            
            savedKeys.forEach(key => {
                const data = JSON.parse(localStorage.getItem(key));
                exportData += `=== ${data.fileName} ===\n`;
                exportData += `ç—…å¤‰æ•°: ${data.annotations.length}\n`;
                exportData += `ä¿å­˜æ—¥æ™‚: ${data.timestamp}\n`;
                
                data.annotations.forEach((ann, index) => {
                    exportData += `  ${index + 1}. ${ann.disease} (${ann.path.length}ç‚¹ã®æç”»)\n`;
                });
                
                exportData += `\n`;
            });
            
            const blob = new Blob([exportData], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `annotation_data_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function clearSpecificData() {
            const fileName = prompt('å‰Šé™¤ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: image001.jpgï¼‰:');
            if (fileName) {
                const key = `annotation_${fileName}`;
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    alert(`${fileName} ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
                    showAllData();
                } else {
                    alert(`${fileName} ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                }
            }
        }
        
        // è‡ªå‹•å®Ÿè¡Œ
        window.onload = function() {
            showAllData();
        };
    </script>
</body>
</html>
EOF < /dev/null